@startuml

entity Users {
  * user_id : int <<PK>>
  --
  firstname : varchar
  lastname : varchar
  phone_number : varchar
  email : varchar
  password : varchar
  is_staff : boolean
  is_staff_manager : boolean
}

entity Orders {
  * order_id : int <<PK>>
  --
  user_id : int <<FK>>
  staff_id : int <<FK>>
  product_id : int <<FK>>
  order_date : timestamp
  payment_date : timestamp
  payment_status : varchar
}

entity OrderItems {
  * order_id : int <<FK>>
  * product_id : int <<FK>>
  * item_id : int
  --
  quantity : int
}

entity OrderStatusHistory {
  * status_id : int <<PK>>
  --
  order_id : int <<FK>>
  status : varchar
  update_date : timestamp
}

entity Products {
  * product_id : int <<PK>>
  --
  product_type : varchar
}

entity Carports {
  * carport_config_id : int <<PK>>
  --
  product_id : int <<FK>>
  width : int
  length : int
  height : int
  roof_type : varchar
  roof_angle : int
  post_sub_product_id : int
  post_color_id : int
  beam_sub_product_id : int
  beam_color_id : int
  rafter_sub_product_id : int
  rafter_color_id : int
  fascia_sub_product_id : int
  fascia_color_id : int
  roof_cover_sub_product_id : int
  roof_cover_color_id : int
}

entity BuildingMaterials {
  * sub_product_id : int <<PK>>
  --
  product_id : int <<FK>>
  name : varchar
  description : text
  width : int
  height : int
  material_type : varchar
  treated_for_ground_contact : boolean
  max_length_between_posts : int
  supports_gutters : boolean
  is_active : boolean
  is_post : boolean
  is_beam : boolean
  is_rafter : boolean
  is_fascia : boolean
  is_roof_cover : boolean
}

entity Colors {
  * color_id : int <<PK>>
  --
  color_name : varchar
  hex_code : varchar
}

entity MaterialColors {
  * sub_product_id : int <<FK>>
  * color_id : int <<FK>>
}

entity PredefinedLengths {
  * id : int <<PK>>
  --
  sub_product_id : int <<FK>>
  length : int
}

entity PriceHistory {
  * price_id : int <<PK>>
  --
  product_id : int <<FK>>
  sub_product_id : int
  price_type : varchar
  price : numeric
  valid_from : date
}

Users ||--o{ Orders : places >
Users ||--o{ Orders : assigned >
Orders ||--o{ OrderStatusHistory : tracks >
Orders ||--o{ OrderItems : contains >
Products ||--o{ OrderItems : typed >
Products ||--o{ Carports : typed >
Products ||--o{ BuildingMaterials : typed >
BuildingMaterials ||--o{ PredefinedLengths : has >
BuildingMaterials ||--o{ MaterialColors : has >
MaterialColors ||--|| Colors : uses >
PriceHistory ||--|| Products
PriceHistory ||--|| BuildingMaterials

@enduml
